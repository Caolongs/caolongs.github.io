---
layout: post
title: "Fastlane"
date: 2018-03-01 
description: "------"
tag: CI 
---   


## ç®€ä»‹
fastlaneæ˜¯ä¸ºiOSå’ŒAndroidåº”ç”¨ç¨‹åºè‡ªåŠ¨åŒ–æµ‹è¯•ç‰ˆéƒ¨ç½²å’Œå‘å¸ƒçš„æœ€ç®€å•æ–¹æ³•ã€‚ğŸš€å®ƒå¤„ç†æ‰€æœ‰ç¹ççš„ä»»åŠ¡ï¼Œä¾‹å¦‚ç”Ÿæˆå±å¹•æˆªå›¾ï¼Œå¤„ç†ä»£ç ç­¾åä»¥åŠå‘å¸ƒåº”ç”¨ç¨‹åºã€‚

æ‚¨å¯ä»¥ä»Fastfileå­˜å‚¨åº“ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¼€å§‹ï¼Œè¿™é‡Œå®šä¹‰äº†æ‚¨çš„æµ‹è¯•ç‰ˆæˆ–App Storeå‘å¸ƒè¿‡ç¨‹ï¼š

```
lane :beta do
  increment_build_number
  build_app
  upload_to_testflight
end

lane :release do
  capture_screenshots
  build_app                 
  upload_to_app_store       # Upload the screenshots and the binary to iTunes
  slack                     # Let your team-mates know the new version is live
end
```

```
gym         # alias for "build_ios_app"
build_app   # alias for "build_ios_app"
```

æ‚¨åªå®šä¹‰äº†2ä¸ªä¸åŒçš„é€šé“ï¼Œä¸€ä¸ªç”¨äºæµ‹è¯•ç‰ˆéƒ¨ç½²ï¼Œå¦ä¸€ä¸ªç”¨äºApp Storeã€‚è¦åœ¨App Storeä¸­å‘å¸ƒä½ çš„åº”ç”¨ç¨‹åºï¼Œä½ æ‰€è¦åšçš„å°±æ˜¯

```
fastlane release
```

## å®‰è£…ä½¿ç”¨fastlane
- ç¡®ä¿å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„Xcodeå‘½ä»¤è¡Œå·¥å…·ï¼š

    ```
    xcode-select --install
    ```
    
- ä½¿ç”¨å®‰è£…fastlane

    ```
    [sudo] gem install fastlane -NV 
    ```
- å¯¼èˆªåˆ°æ‚¨çš„iOSæˆ–Androidåº”ç”¨ç¨‹åºå¹¶è¿è¡Œ
    
    ```
    fastlane init
    
    æ³¨:(å¯¹äºSwiftå®‰è£…ï¼šfastlane init swift)
    ```

 å®‰è£…fastlaneæ ¹æ®æç¤ºä¿¡æ¯å¡«å†™ç›¸å…³ä¿¡æ¯å³å¯ï¼Œç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ç›®å½•ï¼š
![image.png](http://upload-images.jianshu.io/upload_images/1804437-e14d70d6bd40192b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

 
  
 - Appfile => æ˜¯ç”¨æ¥å­˜å‚¨ä¸€äº›å…¬å…±ä¿¡æ¯çš„ï¼Œ
 æ¯”å¦‚app_identifierï¼Œapple_idï¼Œteam_idï¼Œitc_team_idç­‰ [Appfileå¸®åŠ©](https://docs.fastlane.tools/advanced/#appfile)

 - Deliverfile => deliverçš„é…ç½®æ–‡ä»¶ [Deliverfileå¸®åŠ©]( https://docs.fastlane.tools/actions/deliver/)

 - Fastfileï¼Œå…¶ä¸­åŒ…å«åˆ†å‘æ‚¨çš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ˜¯æœ€é‡è¦çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªé‡Œé¢å¯ä»¥ç¼–å†™å’Œå®šåˆ¶æˆ‘ä»¬çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæ‰€æœ‰çš„æµç¨‹æ§åˆ¶åŠŸèƒ½éƒ½å†™åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢ã€‚[Fastfileå¸®åŠ©](https://github.com/fastlane/fastlane/tree/master/fastlane/docs#fastfile)





## é…ç½®æ•ˆæœ
![image.png](http://upload-images.jianshu.io/upload_images/1804437-db3e98dbb4889761.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


```
increment_build_number_in_plist éœ€å®‰è£…æ’ä»¶ fastlane-plugin-versioning
```

## æ’ä»¶
Fastlaneçš„æ’ä»¶æ˜¯ä¸€ä¸ªæˆ–è€…ä¸€ç»„actionçš„æ‰“åŒ…ï¼Œå•ç‹¬å‘å¸ƒåœ¨fastlaneä¹‹å¤–ã€‚[Fastlane Plugin æŒ‡å—](https://docs.fastlane.tools/plugins/create-plugin/)

- æŸ¥çœ‹æ‰€æœ‰æ’ä»¶ï¼š

    ```
    fastlane search_plugins
    ```
- å®‰è£…æ’ä»¶

```
    fastlane add_plugin [æ’ä»¶åç§°]
    
    å¦‚:fastlane add_plugin versioning
```

## ç¯å¢ƒå˜é‡[Environment Variables](https://docs.fastlane.tools/advanced/#environment-variables)
æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æŠŠè´¦å·ä¿¡æ¯ã€æ›´æ–°æè¿°å’Œç‰ˆæœ¬å·ç­‰ä¿¡æ¯å•ç‹¬æ”¾åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚åœ¨è¿™é‡ŒFastlaneç»™æˆ‘ä»¬æä¾›äº†ç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚

æˆ‘ä»¬å¯ä»¥åœ¨å·¥ç¨‹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `.env` çš„æ–‡ä»¶ï¼Œè‡ªå®šä¹‰æ‰€éœ€çš„ä¸´æ—¶å˜é‡ï¼Œç„¶åFastlaneçš„ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼ˆ`Appfile`ã€`Deliverfile`å’Œ`Fastfile`ï¼‰åˆ†åˆ«ä»`.env`æ–‡ä»¶ä¸­è¯»å–é…ç½®ä¿¡æ¯

æ›´å¤šä¿¡æ¯æŸ¥çœ‹[fastlaneæ–‡æ¡£](https://docs.fastlane.tools/advanced/#environment-variables)



## å…¶ä»– (è¾…åŠ©å‘½ä»¤æŸ¥çœ‹)


### 1.0 fastlane actions
*fastlane actions*: åˆ—å‡ºæ‰€æœ‰çš„ fastlane çš„ actionsï¼Œå¯ä»¥çœ‹åˆ° fastlane æ”¯æŒçš„æ‰€æœ‰ action
![image.png](http://upload-images.jianshu.io/upload_images/1804437-9a46b86b5eb468f1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)




### 1.1 fastlane action [name]
`fastlane action [name]` æ˜¾ç¤ºæŸä¸€ä¸ªç‰¹å®šçš„ action çš„è¯¦ç»†é…ç½®

ä¾‹å¦‚ï¼š`fastlane action gym`
![image.png](http://upload-images.jianshu.io/upload_images/1804437-5323c7f613aef7a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)






### 2.0 fastlane lanes

```
fastlane lanes: åˆ—å‡ºæ‰€æœ‰çš„å¯ç”¨çš„ lane åŠå…¶æè¿°ã€‚
è¿™é‡Œæ˜¾ç¤ºçš„å°±æ˜¯ä½ çš„ Fastfile é‡Œé¢å®šä¹‰çš„æ‰€æœ‰ lane
```
### 2.1 fastlane list

```
fastlane list: æ˜¾ç¤ºæ‰€æœ‰çš„ laneï¼Œä½†æ˜¯ä¸æ˜¾ç¤ºæè¿°ã€‚
```


## å‚è€ƒ
1. æ›´å¤šä¿¡æ¯è¯·å‚çœ‹[å®˜æ–¹ç½‘ç«™fastlane docs](https://docs.fastlane.tools/)
2. [iOSä¸­fastlaneçš„ä½¿ç”¨](http://blog.devzeng.com/blog/ios-fastlane-in-action.html)
3. [Fastlaneå¸¦æ¥çš„å…¨è‡ªåŠ¨åŒ–å‘å¸ƒ](https://whlsxl.github.io/)


#æ–‡ç« ç›®å½•
[TOC]
